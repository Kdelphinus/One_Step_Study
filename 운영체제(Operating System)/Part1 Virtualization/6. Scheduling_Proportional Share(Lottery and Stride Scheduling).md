# [Scheduling_Proportional Share(Lottery and Stride Scheduling)](https://pages.cs.wisc.edu/~remzi/OSTEP/Korean/09-cpu-sched-lottery.pdf)

## 0. 개요

이 챕터에선 **비례 배분(Proportional Share)** 스케줄러 혹은 **공정 배분(fair share)** 라고 하는 스케줄러에 대해 다룬다. 이 유형은 말 그대로 각 작업에 대해 CPU의 일정 비율을 보장하는 것이 목적이다.

이 유형의 좋은 예가 **추첨 스케줄링(lottery scheduling)** 이다. 이는 추첨을 통해 다음 프로세스를 정한다는 아주 간단한 개념에서 시작한다.

## 1. 기본 개념: 추첨권이 당신의 몫을 나타낸다.

추첨권은 프로세스가 받아야 할 자원의 몫을 나타내는 데 사용된다. 만약 A가 75장, B가 25장의 추첨권을 가지고 있으면 A에게 75%의 CPU를, B에게 25%의 CPU를 할당하는 것이 목적이다.

스케줄러는 전체 몇 장의 추첨권이 있는지 알고 있어야 하며 그 안에서 추첨을 진행해 다음 프로세스를 결정한다. 무작위적이지만 이 작업이 장시간으로 진행될수록 원하는 비율에 가까워질 확률이 높다.

## 2. 추첨 기법

추첨 기법은 다양하지만 그 중 **추첨권 화폐(ticket currency)** 의 개념이 있다. 이 개념은 사용자가 추첨권을 자신의 화폐 가치로 추첨권을 자유롭게 할당할 수 있도록 허용한다.

만약 사용자 A가 1000장을 할당해서 두 가지 업무에 500장씩 주고 사용자 B가 10장을 할당해서 한 가지 업무에 10장을 준다면 스케줄러는 총 티켓의 비율을 고려하여 사용자 A의 두 가지 업무를 50장, 사용자 B의 한 가지 업무를 100장으로 환산하여 추첨하는 것이다.

다른 기법인 **추첨권 양도(ticket transfer)** 는 일시적으로 추첨권을 다른 프로세스에게 양도하는 기법이다. 프로세스가 서버에게 다른 프로세스를 먼저 진행해달라고 추첨권을 양도하고 나중에 돌려받는 형식이다. 

마지막으로 **추첨권 팽창(ticket inflation)** 은 프로세스가 일시적으로 자신이 소유한 추첨권의 수를 늘리거나 줄일 수 있다. 이 기법은 서로가 신뢰하는 프로세스일 때만 유용하고 CPU에게만 통신하여 자신의 가치를 상향할 수 있다.

## 3, 4. 구현과 예제

이건 문서 참고

## 5. 추첨권 배분 방식

아직까지 미해결

## 6. 왜 결정론적 방법을 사용하지 않는가

앞선 추첨 방식의 스케줄링은 단순하지만 정확한 비율을 보장할 수 없고 특별히 짧은 기간만 실행될 때에는 특히 그러하다. 이를 방지하기 위해 **보폭 스케줄링(stride scheduling)** 이 고안되었다.

각 작업은 추첨권 수에 반비레하는 보폭을 가진다. 

- A: 100장, B: 50장, C: 250장
- 이를 10,000이란 임의의 수로 나누면
- A의 보폭: 100, B의 보폭: 200, C의 보폭: 40

이렇게 보폭이 나왔다면 pass를 이용해 이동한 보폭을 측정할 것이다. 

1. 처음은 모두 0이기에 무작위로 선택되어 이동한다.
2. 만약 하나씩 이동했다면 A, B, C는 각각 자신의 보폭만큼 이동했을 것이다.
3. C가 가장 적은 보폭을 이동했기에 A의 보폭인 100을 넘어서기까지 반복하여 이동한다.
4. 이런 식으로 보폭을 이용해 스케줄링한다.

그러나 보폭 스케줄링은 중간에 들어온 프로세스의 시작점을 둘 수 없는 상황이 생긴다. 0으로 두면 독점할 것이고 같은 선상에 두는 것은 불가하다. 그러나 추첨 방식의 스케줄링은 이를 고려할 필요가 없다. 

그렇기에 아직까지는 범용적인 스케줄러인 MLFQ같은 스케줄러들이 더 많이 사용된다.